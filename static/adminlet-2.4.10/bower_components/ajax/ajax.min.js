/*
 Ajax.JS
 @author	Tom Flidr | tomflidr(at)gmail(dot)com
 @url		https://github.com/tomFlidr/ajax.js
 @licence	https://tomflidr.github.io/ajax.js/LICENSE.md
 @version	1.0.15
 @date	2024-10-29
 @example

    var xhr = Ajax.load(<Ajax.cfg.Load>{
       url: 'https://tomflidr.github.io/ajax.js/books.json',
       method: 'POST', // GET|POST|OPTION|HEAD...
       data: { anything: ["to", "serialize"] },
       success: (data?: any, statusCode?: number, xhr?: XMLHttpRequest|null, requestId?: number, url?: string, type?: string) => {},
       type: 'json', // json|jsonp|xml|html|text
       error: (responseText?: string, statusCode?: number, xhr?: XMLHttpRequest|null, errorObj?: Error|null, errorEvent?: Event|null, requestId?: number, url?: string, type?: string) => {},
       headers: {},
       cache: false,
       async: true
    });

*/
(function(){var q=!1;if("undefined"!=typeof window)var n=window;else n="undefined"!=typeof global?global:{},q=!0;n=n.Ajax=n.Ajax||function(){function e(){}e.handlers={before:[],success:[],abort:[],error:[]};e.defaultHeaders={"X-Requested-With":"XmlHttpRequest","Content-Type":"application/x-www-form-urlencoded"};e.jsonpCallbackParam="callback";e.cacheBusterParamName="_";e.aa="JsonpCallback";e.J=0;e.beforeLoad=function(a){e.handlers.before.push(a);return e};e.onSuccess=function(a){e.handlers.success.push(a);
return e};e.onAbort=function(a){e.handlers.abort.push(a);return e};e.onError=function(a){e.handlers.error.push(a);return e};e.get=function(){var a=new e;return a.v.apply(a,[].slice.apply(arguments)).A()};e.post=function(){var a=new e;return a.v.apply(a,[].slice.apply(arguments)).A("post")};e.load=function(a){return(new e).v(a.url,a.data,a.success,a.type,a.error,a.headers,a.cache,a.async).A(a.method)};e.prototype={toString:function(){return"[object Ajax]"},v:function(a,b,d,c,f,h,g,k){function l(){}
this.url=a||"";this.data=b||{};this.b=d||l;this.type=(void 0===c?"":c).toLowerCase()||"auto";this.error=f||l;this.headers=h||{};this.cache=null==g?!1:g;this.async=null==k?!0:k;this.result={b:!1,data:{}};this.f=this.c=null;return this},A:function(a){this.g=!!document.all;return"jsonp"==this.type?this.S():this.T(a).a},S:function(){var a=this,b=document.createElement("script"),d=a.N();a.h=b;a.requestId=e.J++;a.m=e.aa+a.requestId;e[a.m]=function(c){a.P(c)};a.F("get",!0);b.setAttribute("src",a.url);a.C();
a.g?(b.attachEvent("onreadystatechange",a.s()),b=d.insertAdjacentElement("beforeEnd",b)):(b.setAttribute("async","async"),b.addEventListener("error",a.s(),!0),b=d.appendChild(b));return{url:a.url,id:a.requestId,abort:function(){a.u();a.B()}}},P:function(a){var b=this,d=!1;b.result.b=!0;b.u();b.result.data=a;try{b.b(a,200,null,b.requestId,b.url,b.type),d=!0,b.l()}catch(c){throw d||setTimeout(function(){b.l()}),c;}},s:function(){var a=this,b=a.h;return a.g?function(d){d=d||window.event;"loaded"!=b.readyState||
a.result.b||a.G(d)}:function(d){a.G(d)}},G:function(a){var b=this,d=!1,c=b.s();b.g?b.h.detachEvent("onreadystatechange",c):b.h.removeEventListener("error",c,!0);b.u();b.c=a;b.H();try{b.error("",0,null,null,a,b.requestId,b.url,b.type),d=!0,b.i()}catch(f){throw d||setTimeout(function(){b.i()}),f;}},u:function(){this.h.parentNode.removeChild(this.h);this.g?e[this.m]=void 0:delete e[this.m]},T:function(a){a=(void 0===a?"get":a).toLowerCase();var b=this.F(a,!1);this.requestId=e.J++;this.a=this.K();this.U();
this.a.open(a,this.url,this.async);this.ba();this.C();this.V(a,b);return this},U:function(){function a(c){4==d.readyState&&b.R(c)}var b=this,d=b.a;b.g?b.a.attachEvent("onreadystatechange",a):b.a.addEventListener("readystatechange",a)},R:function(a){a=a||window.event;var b=this.a.status;199<b&&300>b?(this.W(),this.I()):0===b?this.B():(this.result.b=!1,this.c=a,this.f=Error("Http Status Code: "+b),this.I())},V:function(a,b){var d=this.a;"get"==a?d.send():"post"==a&&d.send(b)},I:function(){var a=this,
b=a.a,d=!1,c=[];if(a.result.b){c=[a.result.data,b.status,b,a.requestId,a.url,a.type];try{a.b.apply(null,c),d=!0,a.l()}catch(f){throw d||setTimeout(function(){a.l()}),f;}}else{c=[b.responseText,b.status,b,a.c,a.f,a.requestId,a.url,a.type];a.H();try{a.error.apply(null,c),d=!0,a.i()}catch(f){throw d||setTimeout(function(){a.i()}),f;}}},W:function(){"auto"==this.type&&this.Y();this.X()},X:function(){var a=this.a;"json"==this.type?this.Z():"xml"==this.type||"html"==this.type?this.$():"text"==this.type&&
(this.result.data=a.responseText,this.result.b=!0)},Y:function(){var a=this.O();this.type="text";-1<a.indexOf("javascript")||-1<a.indexOf("json")?this.type="json":-1<a.indexOf("html")?this.type="html":-1<a.indexOf("xml")&&(this.type="xml")},Z:function(){var a=window,b=this.a.responseText;a.JSON||this.o();try{this.result.data=a.JSON.parse(b),this.result.b=!0}catch(d){try{this.result.data=(new Function("return "+b))(),this.result.b=!0}catch(c){}this.f=d}},$:function(){var a={},b=window,d=this.a.responseText,
c=b.DOMParser;try{c?(a=new c,this.result.data=a.parseFromString(d,"application/xml")):(a=new b.ActiveXObject("Microsoft.XMLDOM"),a.async=!1,this.result.data=a.loadXML(d)),this.result.b=!0}catch(f){this.f=f}},O:function(){var a=this.L(),b=a.indexOf("/");-1<b&&(a=a.substr(b+1));return a},L:function(){var a=this.a.getResponseHeader("Content-Type"),b=a.indexOf(";");a=0<a.length?a.toLowerCase():"";-1<b&&(a=a.substr(0,b));return a},K:function(){var a=window,b=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0",
"Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(a.XMLHttpRequest)var d=new a.XMLHttpRequest;else for(var c=0,f=b.length;c<f;c+=1)try{d=new a.ActiveXObject(b[c])}catch(h){}return d},ba:function(){var a=this.a,b=this.headers,d=e.defaultHeaders,c;for(c in b)a.setRequestHeader(c,b[c]);for(c in d)b[c]||a.setRequestHeader(c,d[c])},F:function(a,b){var d="?",c=this.url,f=c.indexOf(d);-1<f&&(d=f===c.length-1?"":"&");a=a.toLowerCase();"get"==a?(a=this.D(!0),c+=d+a,d="&",a=""):a=this.D(!1);this.cache||(c+=d+e.cacheBusterParamName+
"="+ +new Date);b&&(c+=d+e.jsonpCallbackParam+"="+this.M()+"."+this.m);this.url=c;return a},D:function(a){var b=this.data,d=window,c=!!d.JSON;if("string"==typeof b)if(a)c||(c=this.o()),this.data=d.JSON.parse(b);else return b;c||this.o();return this.ca(a)},ca:function(){var a=this.data,b=[];var d=window;var c=d.JSON,f=d.encodeURIComponent,h;for(h in a)if(d=a[h],null==d)b.push(h+"=");else{var g=this.da(d);if("Object"==g)g=f(c.stringify(d)),b.push(h+"="+g);else if("Array"==g)for(var k=0,l=d.length;k<
l;k++)g=f(c.stringify(d[k])),b.push(h+"[]="+g);else g=f(String(d)),b.push(h+"="+g)}return b.join("&")},da:function(a){a=Object.prototype.toString.apply(a);return a.substring(8,a.length-1)},o:function(){window.JSON=function(){function a(c){return 10>c?"0"+c:c}function b(c,f){var h;var g=/["\\\x00-\x1f\x7f-\x9f]/g;var k;switch(typeof c){case "string":return g.test(c)?'"'+c.replace(g,function(r){var p=d[r];if(p)return p;p=r.charCodeAt();return"\\u00"+Math.floor(p/16).toString(16)+(p%16).toString(16)})+
'"':'"'+c+'"';case "number":return isFinite(c)?String(c):"null";case "boolean":case "null":return String(c);case "object":if(!c)return"null";if("function"===typeof c.toJSON)return b(c.toJSON());g=[];if("number"===typeof c.length&&!c.propertyIsEnumerable("length")){var l=c.length;for(h=0;h<l;h+=1)g.push(b(c[h],f)||"null");return"["+g.join(",")+"]"}if(f)for(l=f.length,h=0;h<l;h+=1){var m=f[h];"string"===typeof m&&(k=b(c[m],f))&&g.push(b(m)+":"+k)}else for(m in c)"string"===typeof m&&(k=b(c[m],f))&&
g.push(b(m)+":"+k);return"{"+g.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"};var d={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:b,parse:function(c,f){function h(g,k){var l;if(k&&"object"===typeof k)for(l in k)if(Object.prototype.hasOwnProperty.apply(k,[l])){var m=h(l,k[l]);void 0!==
m&&(k[l]=m)}return f(g,k)}if(/^[\],:{}\s]*$/.test(c.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=eval("("+c+")"),"function"===typeof f?h("",c):c;throw new SyntaxError("parseJSON");}}}();return!0},N:function(){for(var a=document.body;null!==a.previousSibling&&void 0!==a.previousSibling&&(a=a.previousSibling,"head"!=a.nodeName.toLowerCase()););return a},C:function(){this.j("before","jsonp"==this.type?
[null]:[this.a])},l:function(){var a=this.a,b=this.result.data;this.j("success","jsonp"==this.type?[b,200,null]:[b,a.status,a])},B:function(){this.j("abort","jsonp"==this.type?[null]:[this.a])},i:function(){var a=this.a;this.j("error","jsonp"==this.type?["",0,null,null,this.c]:[a.responseText,a.status,a,this.ea,null])},j:function(a,b){function d(){}a=e.handlers[a];b.push(this.requestId,this.url,this.type);for(var c=0,f=a.length;c<f;c+=1)d=a[c],"function"==typeof d&&d.apply(null,b)},H:function(){var a=
window,b=this.requestId,d=this.url,c=this.type,f=this.f,h=this.c,g=this.a;a.console&&("jsonp"==c?a.console.log(b,d,c,0,h):a.console.log(b,d,c,g,g.status,g.responseText,f,f.stack))},M:function(){var a=this.toString();return a.substr(8,a.length-9)}};return e}();q&&"undefined"!=typeof module&&(module.exports=n)})();
